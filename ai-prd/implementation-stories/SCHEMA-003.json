{
  "$schema": "../../planning/schemas/story-schema-v4.2.json",
  "schema_version": "4.2",
  "story_id": "SCHEMA-003",
  "title": "Create V4.2 to V4.3 Migration Tool",
  "type": "tooling",
  "domain": "shared",
  "agent": "be-dev",
  "wave_number": 0,
  "priority": "P1",
  "story_points": 5,
  "status": "pending",
  "description": "Create a migration tool that upgrades V4.2 stories to V4.3 format. Adds new required fields with sensible defaults, preserves all existing data, and validates output against V4.3 schema.",
  "objective": {
    "as_a": "WAVE Developer",
    "i_want": "to migrate existing V4.2 stories to V4.3",
    "so_that": "I can use new V4.3 features without recreating stories from scratch"
  },
  "acceptance_criteria": [
    {
      "id": "AC-01",
      "description": "Tool accepts V4.2 story file as input",
      "ears_format": "WHEN V4.2 story provided THEN tool processes without error",
      "test_approach": "Run tool with V4.2 story, verify no errors",
      "status": "pending"
    },
    {
      "id": "AC-02",
      "description": "All existing fields preserved in output",
      "ears_format": "WHEN story migrated THEN all V4.2 fields have same values",
      "test_approach": "Compare input and output, verify field preservation",
      "status": "pending"
    },
    {
      "id": "AC-03",
      "description": "New V4.3 fields added with defaults",
      "ears_format": "WHEN story migrated THEN context, execution, subtasks fields present",
      "test_approach": "Check output for new fields",
      "status": "pending"
    },
    {
      "id": "AC-04",
      "description": "Output validates against V4.3 schema",
      "ears_format": "WHEN migration complete THEN output passes V4.3 validation",
      "test_approach": "Validate migrated story against V4.3 schema",
      "status": "pending"
    },
    {
      "id": "AC-05",
      "description": "Batch migration supported",
      "ears_format": "WHEN directory of stories provided THEN all stories migrated",
      "test_approach": "Run on directory, verify all files migrated",
      "status": "pending"
    },
    {
      "id": "AC-06",
      "description": "Dry-run mode available",
      "ears_format": "WHEN --dry-run flag used THEN changes shown but files not modified",
      "test_approach": "Run with dry-run, verify no file changes",
      "status": "pending"
    }
  ],
  "files": {
    "create": [
      "tools/migrate-stories-v42-to-v43.ts",
      "tools/__tests__/migrate-stories.test.ts"
    ],
    "modify": [],
    "forbidden": []
  },
  "technical_requirements": {
    "reuse_patterns": {
      "migration_pattern": "Read, transform, validate, write"
    }
  },
  "tdd": {
    "test_framework": "vitest",
    "test_files": [
      "tools/__tests__/migrate-stories.test.ts"
    ],
    "coverage_target": 90,
    "test_categories": [
      {
        "name": "Migration",
        "count": 6,
        "examples": [
          "should preserve existing fields",
          "should add new required fields",
          "should validate output",
          "should handle batch migration",
          "should support dry-run",
          "should report errors clearly"
        ]
      }
    ],
    "mocking_strategy": {
      "filesystem": "Real filesystem with temp directory"
    }
  },
  "safety": {
    "stop_conditions": [
      "Migration corrupts story data"
    ],
    "escalation_triggers": [
      "Validation failures after migration"
    ],
    "rollback_plan": "Keep original files, migration creates new files with .v43 extension"
  },
  "dependencies": {
    "required_before": [
      "SCHEMA-001"
    ],
    "blocks": []
  },
  "traceability": {
    "requirements": [
      "SCHEMA-V43-003"
    ],
    "epic": "AI Stories Schema Improvement",
    "related_stories": [
      "SCHEMA-001",
      "SCHEMA-004"
    ]
  },
  "gates_completed": [],
  "estimated_tests": 6,
  "estimated_tokens": 15000,
  "metadata": {
    "created_at": "2026-02-07T00:00:00Z",
    "created_by": "cto-analysis",
    "agent_assignment": "be-dev-1",
    "progress_note": "0% complete"
  },
  "notes": "Always keep backups. Migration should be idempotent - running twice produces same result.",
  "implementation_notes": "\u274c NOT STARTED: NOT STARTED. Migration tool V4.2\u2192V4.3 not implemented. Manual migration required for 21 existing stories."
}