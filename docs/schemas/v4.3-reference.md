# WAVE AI Story Schema V4.3 Field Reference

**Schema:** `planning/schemas/story-schema-v4.3.json`
**Version:** 4.3
**Date:** 2026-02-07
**Backward Compatible With:** V4.2

---

## Required Fields

These fields must be present in every story.

### `story_id` (string)

Unique story identifier matching pattern `^[A-Z]+-[A-Z0-9]+-?[0-9]*$`.

```json
"story_id": "WAVE-P2-001"
```

Examples: `WAVE1-FE-001`, `BE-03`, `UI-04A`, `SCHEMA-001`

### `title` (string)

Concise story title. Min 5 characters, max 100.

```json
"title": "Implement Redis Pub/Sub Infrastructure"
```

### `domain` (string)

Technical domain ownership. Should match your project's `wave-config.json` domains.

```json
"domain": "backend"
```

Common values: `frontend`, `backend`, `auth`, `shared`, `infrastructure`

### `wave_number` (integer)

Wave assignment. Use 0 for foundation work, 1+ for feature waves.

```json
"wave_number": 2
```

### `priority` (string)

Implementation priority. Accepts both named and coded formats.

```json
"priority": "P0"
```

Values: `P0`, `P1`, `P2`, `P3`, `critical`, `high`, `medium`, `low`

### `status` (string)

Current story lifecycle status.

```json
"status": "pending"
```

Values: `draft`, `pending`, `ready`, `in_progress`, `blocked`, `review`, `complete`, `completed`, `cancelled`, `failed`

### `objective` (object)

User story format with minimum length requirements.

```json
"objective": {
  "as_a": "Developer",
  "i_want": "event-driven signal handling",
  "so_that": "agent communication latency drops below 100ms"
}
```

| Field | Type | Min Length | Description |
|-------|------|-----------|-------------|
| `as_a` | string | 3 | User role or persona |
| `i_want` | string | 10 | Desired action or capability |
| `so_that` | string | 10 | Business value or outcome |

### `acceptance_criteria` (array)

At least one criterion required. Each criterion must have `id` and `description`.

```json
"acceptance_criteria": [
  {
    "id": "AC-01",
    "description": "Orchestrator subscribes to Redis channels on startup",
    "ears_format": "WHEN orchestrator starts THEN subscription exists within 1s",
    "threshold": "latency: <1s",
    "test_approach": "Start orchestrator, verify subscription exists",
    "status": "pending"
  }
]
```

| Field | Required | Description |
|-------|----------|-------------|
| `id` | Yes | Pattern: `AC-01` to `AC-999` |
| `description` | Yes | Min 10 characters |
| `ears_format` | No | EARS syntax: `WHEN/WHILE/WHERE/IF {trigger} THEN {behavior}` |
| `threshold` | No | Performance threshold (e.g., `latency: <500ms`) |
| `test_approach` | No | How to verify this criterion |
| `status` | No | `pending`, `in_progress`, `complete`, `passed`, `failed`, `blocked` |

### `files` (object)

File ownership and boundaries.

```json
"files": {
  "create": ["src/events/signal_handler.py", "tests/events/test_signal_handler.py"],
  "modify": ["src/supervisor.py"],
  "forbidden": ["core/safety/*", "portal/*"],
  "existing": ["src/pubsub/subscriber.py"]
}
```

### `safety` (object)

Safety guardrails. `stop_conditions` is required with at least one item.

```json
"safety": {
  "stop_conditions": ["Build fails", "Existing tests break"],
  "escalation_triggers": ["Cannot resolve merge conflict"],
  "rollback_plan": "git reset --hard HEAD~1"
}
```

---

## New in V4.3

These fields are new in V4.3. All are optional for backward compatibility with V4.2.

### `context` (object)

Context to load before execution. Reduces exploration cost and improves accuracy by giving agents the right files upfront.

```json
"context": {
  "read_files": [
    "src/pubsub/subscriber.py",
    "src/pubsub/types.py",
    "CLAUDE.md"
  ],
  "code_examples": [
    {
      "description": "Command pattern handler",
      "code": "class Handler(ABC):\n    @abstractmethod\n    def handle(self, msg): ...",
      "file_reference": "src/handlers/base.py"
    }
  ],
  "similar_implementations": [
    "src/pubsub/subscriber.py"
  ],
  "domain_knowledge": "docs/event-driven-architecture.md"
}
```

| Field | Type | Description |
|-------|------|-------------|
| `read_files` | string[] | Files agent MUST read before starting |
| `code_examples` | object[] | Code patterns and examples to follow |
| `similar_implementations` | string[] | Paths to similar features for reference |
| `domain_knowledge` | string | Path to domain documentation |

### `execution` (object)

Execution control settings for agent behavior.

```json
"execution": {
  "max_retries": 3,
  "timeout_minutes": 60,
  "model_tier": "sonnet",
  "checkpoint_frequency": "per_gate",
  "parallel_with": ["SCHEMA-004"]
}
```

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `max_retries` | integer (1-10) | 3 | Maximum retry attempts before escalation |
| `timeout_minutes` | integer (5-480) | - | Maximum execution time |
| `model_tier` | string | `sonnet` | `opus` (most capable), `sonnet` (balanced), `haiku` (fastest) |
| `checkpoint_frequency` | string | `per_gate` | `per_subtask`, `per_gate`, `per_criterion`, `on_complete` |
| `parallel_with` | string[] | - | Story IDs that can execute concurrently |

### `subtasks` (array)

Breakdown of complex stories into manageable subtasks with optional checkpointing.

```json
"subtasks": [
  {
    "id": "ST-01",
    "title": "Implement signal handler base class",
    "description": "Create ABC with handle() method and HandlerResult type",
    "estimated_tokens": 2000,
    "checkpoint_after": true,
    "status": "pending"
  },
  {
    "id": "ST-02",
    "title": "Implement concrete handlers",
    "description": "GateComplete, AgentError, AgentBlocked, SessionPause, EmergencyStop",
    "estimated_tokens": 5000,
    "checkpoint_after": true,
    "status": "pending"
  }
]
```

| Field | Required | Description |
|-------|----------|-------------|
| `id` | Yes | Pattern: `ST-01` to `ST-99` |
| `title` | Yes | Short subtask title |
| `description` | No | Detailed description |
| `estimated_tokens` | No | Token budget for this subtask |
| `checkpoint_after` | No | Create checkpoint after completion (default: false) |
| `status` | No | `pending`, `in_progress`, `complete` |

### `enterprise` (object)

Enterprise compliance and approval tracking.

```json
"enterprise": {
  "compliance": ["SOC2", "GDPR"],
  "sla": {
    "response_time": "< 200ms",
    "availability": "99.9%",
    "throughput": "1000 req/s"
  },
  "approvals_required": [
    {
      "role": "security-lead",
      "approved": true,
      "approved_at": "2026-02-07T10:00:00Z",
      "approved_by": "jane.doe"
    }
  ],
  "modification_history": [
    {
      "timestamp": "2026-02-07T10:00:00Z",
      "author": "cto-agent",
      "change_description": "Initial story creation"
    }
  ]
}
```

| Field | Type | Description |
|-------|------|-------------|
| `compliance` | string[] | `GDPR`, `SOC2`, `HIPAA`, `PCI-DSS`, `ISO27001`, `none` |
| `sla` | object | Response time, availability, throughput targets |
| `approvals_required` | object[] | Approval workflow tracking |
| `modification_history` | object[] | Audit trail of changes |

### `output` (object)

Expected output for post-execution validation.

```json
"output": {
  "files_created": ["src/events/signal_handler.py"],
  "files_modified": ["src/supervisor.py"],
  "tests_passing": true,
  "coverage_achieved": 87.5,
  "pr_description": "Refactored orchestrator to event-driven architecture"
}
```

### `validation` (object)

Automated validation commands the agent should run.

```json
"validation": {
  "lint_command": "npm run lint",
  "test_command": "PYTHONPATH=. pytest tests/ -v",
  "build_command": "npm run build",
  "type_check_command": "npx tsc --noEmit"
}
```

---

## Enhanced in V4.3

### `design_source` (object)

Enhanced from V4.2 with component breakdown, interactions, responsiveness, and accessibility.

```json
"design_source": {
  "type": "figma",
  "path": "mockups/dashboard.html",
  "url": "https://figma.com/file/abc123",
  "components": [
    {
      "name": "DashboardCard",
      "type": "component",
      "props": { "title": "string", "value": "number" },
      "state": ["isLoading", "hasError"],
      "events": ["onClick", "onRefresh"]
    }
  ],
  "interactions": [
    {
      "trigger": "click on card",
      "action": "navigate to detail view",
      "target": "DashboardCard"
    }
  ],
  "responsive": {
    "mobile": "Stack cards vertically, hide secondary metrics",
    "tablet": "2-column grid",
    "desktop": "4-column grid with sidebar"
  },
  "accessibility": {
    "wcag_level": "AA",
    "aria_requirements": ["aria-label on cards", "role=region on dashboard"],
    "keyboard_navigation": true,
    "screen_reader_tested": false
  }
}
```

New V4.3 fields in `design_source`:

| Field | Type | Description |
|-------|------|-------------|
| `components` | object[] | Component breakdown with props, state, events |
| `interactions` | object[] | User interaction specifications |
| `responsive` | object | Viewport-specific layout specs |
| `accessibility` | object | WCAG level, ARIA, keyboard, screen reader |

---

## Unchanged from V4.2

These fields work identically in V4.2 and V4.3:

- `$schema`, `schema_version`
- `type`, `agent`, `story_points`, `description`
- `technical_requirements` (database_tables, api_endpoints, reuse_patterns, hooks, etc.)
- `design_specs` (layout, colors, typography)
- `tdd` (test_framework, test_files, coverage_target, test_categories, mocking_strategy)
- `hazard_analysis` (identified_hazards, risk_level)
- `dependencies` (required_before, blocks)
- `traceability` (requirements, epic, related_stories)
- `gates_completed`
- `estimated_tests`, `estimated_tokens`, `actual_tokens`
- `metadata` (created_at, updated_at, created_by, completed_at, agent_assignment)
- `gate0_research`, `notes`
