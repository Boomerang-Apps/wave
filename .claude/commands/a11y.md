# /a11y - Accessibility Audit

**Tier:** 2 (Workflow Command)
**Priority:** P1 (HIGH)
**Recommended Model:** Sonnet
**Aliases:** /accessibility, /wcag, /aria

## Purpose

Focused accessibility analysis including WCAG 2.1 compliance, screen reader compatibility, keyboard navigation, and color contrast validation.

## Usage

```bash
/a11y                      # Full accessibility audit
/a11y contrast             # Color contrast only
/a11y keyboard             # Keyboard navigation only
/a11y aria                 # ARIA attributes only
/a11y forms                # Form accessibility only
/a11y --fix                # Auto-fix where possible
```

---

## What It Checks

| Check | Tool | Standard |
|-------|------|----------|
| WCAG 2.1 Level A | `axe-core` | Required |
| WCAG 2.1 Level AA | `axe-core` | Required |
| Color contrast | `axe-core` | 4.5:1 (AA) |
| Keyboard navigation | `axe-core` + manual | All interactive |
| Screen reader | `axe-core` | ARIA compliant |
| Focus indicators | Custom | Visible focus |
| Alt text | `axe-core` | All images |
| Form labels | `axe-core` | All inputs |
| Heading hierarchy | `axe-core` | Logical order |
| Link purpose | `axe-core` | Clear text |
| Language attribute | Custom | html[lang] |
| Skip links | Custom | Present |

---

## Commands Run

```bash
# Axe-core scan (via Playwright)
npx playwright test --grep "@a11y" --reporter=json

# Lighthouse accessibility
npx lighthouse http://localhost:3000 --only-categories=accessibility --output=json

# Pa11y scan
npx pa11y http://localhost:3000 --reporter json

# Custom checks
grep -r "img" src/ | grep -v "alt="
grep -r "<a" src/ | grep -v "aria-label"
```

---

## Output

```
╔══════════════════════════════════════════════════════════════════════════════╗
║  ACCESSIBILITY AUDIT                                                  /a11y  ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║  WCAG 2.1 COMPLIANCE                                                         ║
║  ───────────────────                                                         ║
║                                                                              ║
║  Level A:   ████████████████████████ 100%  ✓ PASS                           ║
║  Level AA:  ██████████████████████░░  92%  ⚠ ISSUES                         ║
║  Level AAA: ████████████████░░░░░░░░  67%  ℹ INFO                           ║
║                                                                              ║
║  AUTOMATED SCAN RESULTS                                                      ║
║  ──────────────────────                                                      ║
║                                                                              ║
║  ┌──────────────┬───────┬──────────────────────────────────────────────────┐ ║
║  │ Severity     │ Count │ Status                                           │ ║
║  ├──────────────┼───────┼──────────────────────────────────────────────────┤ ║
║  │ Critical     │ 0     │ ✓ Pass                                           │ ║
║  │ Serious      │ 2     │ ✗ Fail                                           │ ║
║  │ Moderate     │ 3     │ ⚠ Review                                         │ ║
║  │ Minor        │ 5     │ ⚠ Review                                         │ ║
║  └──────────────┴───────┴──────────────────────────────────────────────────┘ ║
║                                                                              ║
║  COLOR CONTRAST                                                              ║
║  ──────────────                                                              ║
║                                                                              ║
║  ⚠ 2 contrast issues found:                                                 ║
║                                                                              ║
║  ┌────────────────────────────┬───────────┬───────────┬─────────────────────┐║
║  │ Element                    │ Ratio     │ Required  │ Fix                 │║
║  ├────────────────────────────┼───────────┼───────────┼─────────────────────┤║
║  │ .text-muted (gray-400)     │ 3.8:1     │ 4.5:1     │ Use gray-500        │║
║  │ .btn-secondary text        │ 4.1:1     │ 4.5:1     │ Darken text         │║
║  └────────────────────────────┴───────────┴───────────┴─────────────────────┘║
║                                                                              ║
║  KEYBOARD NAVIGATION                                                         ║
║  ───────────────────                                                         ║
║                                                                              ║
║  ✓ All interactive elements focusable                                       ║
║  ✓ Focus order logical                                                      ║
║  ✓ No keyboard traps                                                        ║
║  ⚠ 1 missing focus indicator:                                               ║
║    └── .card-link:focus (no visible outline)                                ║
║                                                                              ║
║  SCREEN READER                                                               ║
║  ─────────────                                                               ║
║                                                                              ║
║  ┌────────────────────────────────────┬────────┬───────────────────────────┐ ║
║  │ Check                              │ Status │ Details                   │ ║
║  ├────────────────────────────────────┼────────┼───────────────────────────┤ ║
║  │ Images have alt text               │ ⚠ Warn │ 2 decorative missing ""   │ ║
║  │ Form inputs have labels            │ ✓ Pass │ All labeled               │ ║
║  │ ARIA roles correct                 │ ✓ Pass │ Valid usage               │ ║
║  │ Landmarks present                  │ ✓ Pass │ main, nav, footer         │ ║
║  │ Headings hierarchy                 │ ✓ Pass │ h1→h2→h3 logical          │ ║
║  │ Link text descriptive              │ ⚠ Warn │ 3 "click here" links      │ ║
║  │ Tables have headers                │ ✓ Pass │ th elements present       │ ║
║  │ Language attribute                 │ ✓ Pass │ html[lang="he"]           │ ║
║  └────────────────────────────────────┴────────┴───────────────────────────┘ ║
║                                                                              ║
║  FORMS                                                                       ║
║  ─────                                                                       ║
║                                                                              ║
║  ✓ All inputs have associated labels                                        ║
║  ✓ Required fields marked with aria-required                                ║
║  ✓ Error messages linked with aria-describedby                              ║
║  ✓ Form validation announced to screen readers                              ║
║                                                                              ║
║  INTERACTIVE ELEMENTS                                                        ║
║  ────────────────────                                                        ║
║                                                                              ║
║  ┌────────────────────────────┬────────┬───────────────────────────────────┐ ║
║  │ Element                    │ Status │ Issue                             │ ║
║  ├────────────────────────────┼────────┼───────────────────────────────────┤ ║
║  │ Buttons                    │ ✓ Pass │ All have accessible names         │ ║
║  │ Links                      │ ⚠ Warn │ 3 generic "click here"            │ ║
║  │ Modals                     │ ✓ Pass │ Focus trapped, ESC closes         │ ║
║  │ Dropdowns                  │ ✓ Pass │ Arrow keys work                   │ ║
║  │ Tabs                       │ ✓ Pass │ ARIA tabs pattern                 │ ║
║  │ Tooltips                   │ ✓ Pass │ aria-describedby linked           │ ║
║  └────────────────────────────┴────────┴───────────────────────────────────┘ ║
║                                                                              ║
║  RTL SUPPORT (Hebrew)                                                        ║
║  ────────────────────                                                        ║
║                                                                              ║
║  ✓ dir="rtl" on html element                                                ║
║  ✓ Logical properties used (start/end vs left/right)                        ║
║  ✓ Bidirectional text handled correctly                                     ║
║  ✓ Icons mirrored appropriately                                             ║
║                                                                              ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  ACCESSIBILITY SCORE: 92/100 (Lighthouse)                                    ║
║  STATUS: ⚠ REVIEW REQUIRED                                                   ║
║                                                                              ║
║  REQUIRED FIXES (Level AA):                                                  ║
║  1. Fix 2 color contrast issues                                             ║
║  2. Add focus indicator to .card-link                                       ║
║  3. Add alt="" to 2 decorative images                                       ║
║                                                                              ║
║  RECOMMENDED (Level AAA):                                                    ║
║  1. Replace 3 "click here" links with descriptive text                      ║
║  2. Add skip-to-content link                                                ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

---

## Auto-Fix (`/a11y --fix`)

```bash
/a11y --fix contrast      # Update color tokens
/a11y --fix focus         # Add focus styles
/a11y --fix alt           # Add empty alt to decorative
/a11y --fix all           # Fix all auto-fixable
```

### Contrast Fix
```css
/* Before */
.text-muted { color: var(--gray-400); }  /* 3.8:1 */

/* After (auto-fixed) */
.text-muted { color: var(--gray-500); }  /* 5.2:1 ✓ */
```

### Focus Fix
```css
/* Added to globals.css */
.card-link:focus {
  outline: 2px solid var(--ring);
  outline-offset: 2px;
}
```

---

## WCAG Quick Reference

| Level | Requirement | Example |
|-------|-------------|---------|
| A | Basic accessibility | Alt text, form labels |
| AA | Standard compliance | Contrast 4.5:1, resize 200% |
| AAA | Enhanced accessibility | Contrast 7:1, sign language |

---

## Integration

```bash
# Part of /harden
/harden a11y

# Standalone
/a11y

# CI mode (fails on serious issues)
/a11y --ci

# Specific checks
/a11y contrast
/a11y keyboard
/a11y forms
```

---

## Testing Tools

| Tool | Purpose |
|------|---------|
| `axe-core` | Automated WCAG testing |
| `pa11y` | CLI accessibility testing |
| Lighthouse | Accessibility scoring |
| VoiceOver | macOS screen reader |
| NVDA | Windows screen reader |
| Stark | Figma contrast checker |

---

## Research Validation

This command is backed by industry standards and best practices:

### Accessibility Standards
| Source | Type | URL |
|--------|------|-----|
| WCAG 2.1 | W3C Standard | https://www.w3.org/WAI/standards-guidelines/wcag/ |
| WCAG 2.1 AA Checklist | Best Practice | https://accessible.org/wcag/ |
| ADA Title II (2024) | US Regulation | https://www.ada.gov/resources/web-guidance/ |
| axe-core | Tool Documentation | https://github.com/dequelabs/axe-core |
| Pa11y | Tool Documentation | https://pa11y.org/ |
| WebAIM Checklist | Best Practice | https://webaim.org/standards/wcag/checklist |

### WCAG 2.1 Level AA Key Criteria
| Criterion | Requirement |
|-----------|-------------|
| 1.4.3 Contrast | 4.5:1 ratio for normal text |
| 1.4.4 Resize Text | Up to 200% without loss |
| 2.1.1 Keyboard | All functionality keyboard accessible |
| 2.4.6 Headings | Descriptive headings and labels |
| 3.1.1 Language | Page language programmatically determined |

### Tool Coverage Comparison
| Tool | Coverage | Approach |
|------|----------|----------|
| axe-core | 27% (39 issues) | Violations + potential issues |
| Pa11y | 20% (29 issues) | Issues only |
| Combined | 35% (49 issues) | Recommended approach |

### Key Insights Applied
- ADA Title II (April 2024) establishes WCAG 2.1 Level AA as legal standard
- axe-core returns passed, incomplete (manual review), and violations
- Pa11y provides CLI-first approach ideal for CI/CD pipelines
- Combined tools catch more issues than either alone
- Automated tools only catch ~35% - manual testing still required

---

## Related Commands

| Command | Focus |
|---------|-------|
| `/harden` | Full hardening (includes a11y) |
| `/design-system` | Design token management |
| `/perf` | Performance (also affects a11y) |

